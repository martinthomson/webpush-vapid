<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Voluntary Application Server Identification (VAPID) for Web Push</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Voluntary Identification">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Notational Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 Application Server Self-Identification">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Application Server Contact Information">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Additional Claims">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Cryptographic Agility">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Example">
<link href="#rfc.section.3" rel="Chapter" title="3 Vapid Authentication Scheme">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Token Parameter (t)">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Public Key Parameter (k)">
<link href="#rfc.section.4" rel="Chapter" title="4 Subscription Restriction">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Creating a Restricted Push Subscription">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Using Restricted Subscriptions">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Vapid Authentication Scheme Parameters">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.6.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M. and P. Beverloo" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-webpush-vapid-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-6-18" />
  <meta name="dct.abstract" content="An application server can use the method described to voluntarily identify itself to a push service.  This identification information can be used by the push service to attribute requests that are made by the same application server to a single entity.  An application server can include additional information that the operator of a push service can use to contact the operator of the application server.  This identification information can be used to restrict the use of a push subscription a single application server." />
  <meta name="description" content="An application server can use the method described to voluntarily identify itself to a push service.  This identification information can be used by the push service to attribute requests that are made by the same application server to a single entity.  An application server can include additional information that the operator of a push service can use to contact the operator of the application server.  This identification information can be used to restrict the use of a push subscription a single application server." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Thomson</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Mozilla</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">P. Beverloo</td>
</tr>
<tr>
<td class="left">Expires: December 20, 2017</td>
<td class="right">Google</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 18, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Voluntary Application Server Identification (VAPID) for Web Push<br />
  <span class="filename">draft-ietf-webpush-vapid-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>An application server can use the method described to voluntarily identify itself to a push service.  This identification information can be used by the push service to attribute requests that are made by the same application server to a single entity.  An application server can include additional information that the operator of a push service can use to contact the operator of the application server.  This identification information can be used to restrict the use of a push subscription a single application server.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 20, 2017.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Voluntary Identification</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Notational Conventions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Application Server Self-Identification</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Application Server Contact Information</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Additional Claims</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Cryptographic Agility</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">Example</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Vapid Authentication Scheme</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Token Parameter (t)</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Public Key Parameter (k)</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Subscription Restriction</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Creating a Restricted Push Subscription</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Using Restricted Subscriptions</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Vapid Authentication Scheme Parameters</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The Web Push protocol <a href="#RFC8030" class="xref">[RFC8030]</a> describes how an application server is able to request that a push service deliver a push message to a user agent.</p>
<p id="rfc.section.1.p.2">As a consequence of the expected deployment architecture, there is no basis for an application server to be known to a push service prior to requesting delivery of a push message.  Requiring that the push service be able to authenticate application servers places an unwanted constraint on the interactions between user agents and application servers, who are the ultimate users of a push service.  That constraint would also degrade the privacy-preserving properties the protocol provides.  For these reasons, <a href="#RFC8030" class="xref">[RFC8030]</a> does not define a mandatory system for authentication of application servers.</p>
<p id="rfc.section.1.p.3">An unfortunate consequence of this design is that a push service is exposed to a greater risk of denial of service attack.  While requests from application servers can be indirectly attributed to user agents, this is not always efficient or even sufficient.  Providing more information about the application server directly to a push service allows the push service to better distinguish between legitimate and bogus requests.</p>
<p id="rfc.section.1.p.4">Additionally, this design also relies on endpoint secrecy as any application server in possession of the endpoint is able to send messages, albeit without payloads.  In situations where usage of a subscription can be limited to a single application server, the ability to associate a subscription with the application server could reduce the impact of a data leak.</p>
<h2 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#voluntary-identification" id="voluntary-identification">Voluntary Identification</a>
</h2>
<p id="rfc.section.1.1.p.1">This document describes a system whereby an application server can volunteer information about itself to a push service.  At a minimum, this provides a stable identity for the application server, though this could also include contact information, such as an email address.</p>
<p id="rfc.section.1.1.p.2">A consistent identity can be used by a push service to establish behavioral expectations for an application server.  Significant deviations from an established norm can then be used to trigger exception handling procedures.</p>
<p id="rfc.section.1.1.p.3">Voluntarily-provided contact information can be used to contact an application server operator in the case of exceptional situations.</p>
<p id="rfc.section.1.1.p.4">Experience with push service deployment has shown that software errors or unusual circumstances can cause large increases in push message volume.  Contacting the operator of the application server has proven to be valuable.</p>
<p id="rfc.section.1.1.p.5">Even in the absence of usable contact information, an application server that has a well-established reputation might be given preference over an unidentified application server when choosing whether to discard a push message.</p>
<h2 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a>
</h2>
<p id="rfc.section.1.2.p.1">The words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;SHOULD&#8221;, and &#8220;MAY&#8221; are used in this document.  It&#8217;s not shouting, when they are capitalized, they have the special meaning described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<p id="rfc.section.1.2.p.2">The terms &#8220;push message&#8221;, &#8220;push service&#8221;, &#8220;push subscription&#8221;, &#8220;application server&#8221;, and &#8220;user agent&#8221; are used as defined in <a href="#RFC8030" class="xref">[RFC8030]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#jwt" id="jwt">Application Server Self-Identification</a>
</h1>
<p id="rfc.section.2.p.1">Application servers that wish to self-identify generate and maintain a signing key pair.  This key pair MUST be usable with elliptic curve digital signature (ECDSA) over the P-256 curve <a href="#FIPS186" class="xref">[FIPS186]</a>.  Use of this key when sending push messages establishes an identity for the application server that is consistent across multiple messages.</p>
<p id="rfc.section.2.p.2">When requesting delivery of a push message, the application includes a JSON Web Token (JWT) <a href="#RFC7519" class="xref">[RFC7519]</a>, signed using its signing key.  The token includes a number of claims as follows:</p>
<p></p>

<ul>
<li>An &#8220;aud&#8221; (Audience) claim in the token MUST include the unicode serialization of the origin (Section 6.1 of <a href="#RFC6454" class="xref">[RFC6454]</a>) of the push resource URL.  This binds the token to a specific push service.  This ensures that the token is reusable for all push resource URLs that share the same origin.</li>
<li>An &#8220;exp&#8221; (Expiry) claim MUST be included with the time after which the token expires.  This limits the time over which a token is valid.  An &#8220;exp&#8221; claim MUST NOT be more than 24 hours from the time of the request.</li>
</ul>
<p id="rfc.section.2.p.4">This JWT is included in an Authorization header field, using an auth-scheme of &#8220;vapid&#8221;.  A push service MAY reject a request with a 403 (Forbidden) status code <a href="#RFC7235" class="xref">[RFC7235]</a> if the JWT signature or its claims are invalid.</p>
<p id="rfc.section.2.p.5">The JWT MUST use a JSON Web Signature (JWS) <a href="#RFC7515" class="xref">[RFC7515]</a>.  The signature MUST use ECDSA on the NIST P-256 curve <a href="#FIPS186" class="xref">[FIPS186]</a> which is identified as &#8220;ES256&#8221; <a href="#RFC7518" class="xref">[RFC7518]</a>.</p>
<h2 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#application-server-contact-information" id="application-server-contact-information">Application Server Contact Information</a>
</h2>
<p id="rfc.section.2.1.p.1">If the application server wishes to provide contact details it MAY include a &#8220;sub&#8221; (Subject) claim in the JWT.  The &#8220;sub&#8221; claim SHOULD include a contact URI for the application server as either a &#8220;mailto:&#8221; (email) <a href="#RFC6068" class="xref">[RFC6068]</a> or an &#8220;https:&#8221; <a href="#RFC2818" class="xref">[RFC2818]</a> URI.</p>
<h2 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#additional-claims" id="additional-claims">Additional Claims</a>
</h2>
<p id="rfc.section.2.2.p.1">An application server MAY include additional claims using public or private names (see Sections 4.2 and 4.3 of <a href="#RFC7519" class="xref">[RFC7519]</a>).  Since the JWT is in a header field, the size of additional claims SHOULD be kept as small as possible.</p>
<h2 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#cryptographic-agility" id="cryptographic-agility">Cryptographic Agility</a>
</h2>
<p id="rfc.section.2.3.p.1">The &#8220;vapid&#8221; authentication scheme is used to identify the specific profile of JWT defined in this document.  A different authentication scheme is needed to update the signature algorithm or other parameters.  This ensures that existing mechanisms for negotiating authentication scheme can be used rather than defining new parameter negotiation mechanisms.</p>
<h2 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#example" id="example">Example</a>
</h2>
<p id="rfc.section.2.4.p.1">An application server requests the delivery of a push message as described in <a href="#RFC8030" class="xref">[RFC8030]</a>.  If the application server wishes to self-identify, it includes an Authorization header field with credentials that use the &#8220;vapid&#8221; authentication scheme (<a href="#auth" class="xref">Section 3</a>).</p>
<div id="rfc.figure.1"></div>
<div id="ex-push"></div>
<pre>
POST /p/JzLQ3raZJfFBR0aqvOMsLrt54w4rJUsV HTTP/1.1
Host: push.example.net
TTL: 30
Content-Length: 136
Content-Encoding: aes128gcm
Authorization: vapid
   t=eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJhdWQiOiJodHRwczovL3
     B1c2guZXhhbXBsZS5uZXQiLCJleHAiOjE0NTM1MjM3NjgsInN1YiI6Im1ha
     Wx0bzpwdXNoQGV4YW1wbGUuY29tIn0.i3CYb7t4xfxCDquptFOepC9GAu_H
     LGkMlMuCGSK2rpiUfnK9ojFwDXb1JrErtmysazNjjvW2L9OkSSHzvoD1oA,
   k=BA1Hxzyi1RUM1b5wjxsn7nGxAszw2u61m164i3MrAIxHF6YK5h4SDYic-dR
     uU_RCPCfA5aq9ojSwk5Y2EmClBPs

{ encrypted push message }
</pre>
<p class="figure">Figure 1: Requesting Push Message Delivery with JWT</p>
<p id="rfc.section.2.4.p.2">Note that the example header fields in this document include extra line wrapping to meet formatting constraints.</p>
<p id="rfc.section.2.4.p.3">The <samp>t</samp> parameter of the Authorization header field contains a JWT; the <samp>k</samp> parameter includes the base64url-encoded key that signed that token.  The JWT input values and the JWK <a href="#RFC7517" class="xref">[RFC7517]</a> corresponding to the signing key are shown in <a href="#ex-decoded" class="xref">Figure 2</a> with additional whitespace added for readability purposes.  This JWT would be valid until 2016-01-23T04:36:08Z <a href="#RFC3339" class="xref">[RFC3339]</a>.</p>
<div id="rfc.figure.2"></div>
<div id="ex-decoded"></div>
<pre>
JWT header = { "typ": "JWT", "alg": "ES256" }
JWT body = { "aud": "https://push.example.net",
             "exp": 1453523768,
             "sub": "mailto:push@example.com" }
JWK = { "crv":"P-256",
        "kty":"EC",
        "x":"DUfHPKLVFQzVvnCPGyfucbECzPDa7rWbXriLcysAjEc",
        "y":"F6YK5h4SDYic-dRuU_RCPCfA5aq9ojSwk5Y2EmClBPs" }
</pre>
<p class="figure">Figure 2: Decoded Example Values</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#auth" id="auth">Vapid Authentication Scheme</a>
</h1>
<p id="rfc.section.3.p.1">A new &#8220;vapid&#8221; HTTP authentication scheme <a href="#RFC7235" class="xref">[RFC7235]</a> is defined.  This authentication scheme carries a signed JWT, as described in <a href="#jwt" class="xref">Section 2</a>, plus the key that signed that JWT.</p>
<p id="rfc.section.3.p.2">This authentication scheme is for origin-server authentication only.  Therefore, this authentication scheme MUST NOT be used with the Proxy-Authenticate or Proxy-Authorization header fields.</p>
<p id="rfc.section.3.p.3">This authentication scheme does not require a challenge.  Clients are able to generate the Authorization header field without any additional information from a server.  Therefore, a challenge for this authentication scheme MUST NOT be sent in a WWW-Authenticate header field.</p>
<p id="rfc.section.3.p.4">Two parameters are defined for this authentication scheme: <samp>t</samp> and <samp>k</samp>.  All unknown or unsupported parameters to &#8220;vapid&#8221; authentication credentials MUST be ignored.  The <samp>realm</samp> parameter is ignored for this authentication scheme.</p>
<p id="rfc.section.3.p.5">This authentication scheme is intended for use by an application server when using the Web Push protocol <a href="#RFC8030" class="xref">[RFC8030]</a>, but it could be used in other contexts if applicable.</p>
<h2 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#token" id="token">Token Parameter (t)</a>
</h2>
<p id="rfc.section.3.1.p.1">The <samp>t</samp> parameter of the &#8220;vapid&#8221; authentication scheme carries a JWT as described in <a href="#jwt" class="xref">Section 2</a>.</p>
<h2 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#key" id="key">Public Key Parameter (k)</a>
</h2>
<p id="rfc.section.3.2.p.1">In order for the push service to be able to validate the JWT, it needs to learn the public key of the application server.  A <samp>k</samp> parameter is defined for the &#8220;vapid&#8221; authentication scheme to carry this information.</p>
<p id="rfc.section.3.2.p.2">The <samp>k</samp> parameter includes an elliptic curve digital signature algorithm (ECDSA) public key <a href="#FIPS186" class="xref">[FIPS186]</a> in uncompressed form <a href="#X9.62" class="xref">[X9.62]</a> that is encoded using base64url encoding <a href="#RFC7515" class="xref">[RFC7515]</a>.</p>
<p></p>

<dl>
<dt>Note:</dt>
<dd style="margin-left: 8">X9.62 encoding is used over JWK <a href="#RFC7517" class="xref">[RFC7517]</a> for two reasons.  A JWK does not have a canonical form, so X9.62 encoding makes it easier for the push service to handle comparison of keys from different sources.  Secondarily, the X9.62 encoding is also considerably smaller.</dd>
</dl>
<p id="rfc.section.3.2.p.4">Some implementations permit the same P-256 key to be used for signing and key exchange.  An application server MUST select a different private key for the key exchange <a href="#I-D.ietf-webpush-encryption" class="xref">[I-D.ietf-webpush-encryption]</a> and signing the authentication token.  Though a push service is not obligated to check either parameter for every push message, a push service SHOULD reject push messages that have identical values for these parameters with a 400 (Bad Request) status code.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#restrict" id="restrict">Subscription Restriction</a>
</h1>
<p id="rfc.section.4.p.1">The public key of the application server serves as a stable identifier for the server.  This key can be used to restrict a push subscription to a specific application server.</p>
<p id="rfc.section.4.p.2">Subscription restriction reduces the reliance on endpoint secrecy by requiring proof of possession to be demonstrated by an application server when requesting delivery of a push message.  This provides an additional level of protection against leaking of the details of the push subscription.</p>
<h2 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#creating-a-restricted-push-subscription" id="creating-a-restricted-push-subscription">Creating a Restricted Push Subscription</a>
</h2>
<p id="rfc.section.4.1.p.1">The user agent includes the public key of the application server when requesting the creation of a push subscription.  This restricts use of the resulting subscription to application servers that are able to provide proof of possession for the corresponding private key.</p>
<p id="rfc.section.4.1.p.2">The public key is then added to the request to create a push subscription.  The push subscription request is extended to include a body.  The body of the request is a JSON object as described in <a href="#RFC7159" class="xref">[RFC7159]</a>.  A &#8220;vapid&#8221; member is added to this JSON object, containing the public key on the P-256 curve, encoded in the uncompressed form <a href="#X9.62" class="xref">[X9.62]</a> and base64url encoded <a href="#RFC7515" class="xref">[RFC7515]</a>.  The MIME media type of the body is set to &#8220;application/json&#8221;.</p>
<p id="rfc.section.4.1.p.3">The example in <a href="#ex-restrict" class="xref">Figure 3</a> shows a restriction to the key used in <a href="#ex-push" class="xref">Figure 1</a>.  Extra whitespace is added to meet formatting constraints.</p>
<div id="rfc.figure.3"></div>
<div id="ex-restrict"></div>
<pre>
POST /subscribe/ HTTP/1.1
Host: push.example.net
Content-Type: application/json;charset=utf-8
Content-Length: 104

{ "vapid": "BA1Hxzyi1RUM1b5wjxsn7nGxAszw2u61m164i3MrAIxH
            F6YK5h4SDYic-dRuU_RCPCfA5aq9ojSwk5Y2EmClBPs" }
</pre>
<p class="figure">Figure 3: Example Subscribe Request</p>
<p id="rfc.section.4.1.p.4">An application might use the Web Push API <a href="#API" class="xref">[API]</a> to provide the user agent with a public key.</p>
<h2 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#using-restricted-subscriptions" id="using-restricted-subscriptions">Using Restricted Subscriptions</a>
</h2>
<p id="rfc.section.4.2.p.1">When a push subscription has been associated with an application server, the request for push message delivery MUST include proof of possession for the associated private key that was used when creating the push subscription.</p>
<p id="rfc.section.4.2.p.2">A push service MUST reject a message that omits mandatory credentials with a 401 (Unauthorized) status code.  A push service MAY reject a message that includes invalid credentials with a 403 (Forbidden) status code.  Credentials are invalid if:</p>
<p></p>

<ul>
<li>either the authentication token or public key are not included in the request,</li>
<li>the signature on the JWT cannot be successfully verified using the included public key,</li>
<li>the current time is later than the time identified in the &#8220;exp&#8221; (Expiry) claim or more than 24 hours before the expiry time,</li>
<li>the origin of the push resource is not included in the &#8220;aud&#8221; (Audience) claim, or</li>
<li>the public key used to sign the JWT doesn&#8217;t match the one that was included in the creation of the push subscription.</li>
</ul>
<p id="rfc.section.4.2.p.4">A push service MUST NOT forward the JWT or public key to the user agent when delivering the push message.</p>
<p id="rfc.section.4.2.p.5">An application server that needs to replace its signing key needs to create a new subscription that is restricted to the updated key.  Application servers need to remember the key that was used when creating a given subscription.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This authentication scheme is vulnerable to replay attacks if an attacker can acquire a valid JWT.  Applying narrow limits to the period over which a replayable token can be reused limits the potential value of a stolen token to an attacker and can increase the difficulty of stealing a token.</p>
<p id="rfc.section.5.p.2">An application server might offer falsified contact information.  A push service operator therefore cannot use the presence of unvalidated contact information as input to any security-critical decision-making process.</p>
<p id="rfc.section.5.p.3">Validation of a signature on the JWT requires a non-trivial amount of computation.  For something that might be used to identify legitimate requests under denial of service attack conditions, this is not ideal.  Application servers are therefore encouraged to reuse tokens, which permits the push service to cache the results of signature validation.</p>
<p id="rfc.section.5.p.4">An application server that changes its signing key breaks linkability between push messages that it sends under the different keys.  A push service that relies on a consistent identity for application servers might categorize requests made with new keys differently.  Gradual migration to a new signing key reduces the chances that requests that use the new key will be categorized as abusive.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This document registers the &#8220;vapid&#8221; authentication scheme in the &#8220;Hypertext Transfer Protocol (HTTP) Authentication Scheme Registry&#8221; established in <a href="#RFC7235" class="xref">[RFC7235]</a>.</p>
<p></p>

<dl>
<dt>Authentication Scheme Name:</dt>
<dd style="margin-left: 8">vapid</dd>
<dt>Pointer to specification text:</dt>
<dd style="margin-left: 8">
<a href="#auth" class="xref">Section 3</a> of this document</dd>
<dt>Notes:</dt>
<dd style="margin-left: 8">This scheme is origin-server only and does not define a challenge.</dd>
</dl>
<h2 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#vapid-authentication-scheme-parameters" id="vapid-authentication-scheme-parameters">Vapid Authentication Scheme Parameters</a>
</h2>
<p id="rfc.section.6.1.p.1">This document creates a &#8220;Vapid Authentication Scheme Parameters&#8221; registry for parameters to the &#8220;vapid&#8221; authentication scheme.  This registry is under the &#8220;WebPush Parameters&#8221; grouping.  The registry operates on the &#8220;Specification Required&#8221; policy <a href="#RFC5226" class="xref">[RFC5226]</a>.</p>
<p id="rfc.section.6.1.p.2">Registrations MUST include the following information:</p>
<p></p>

<dl>
<dt>Parameter Name:</dt>
<dd style="margin-left: 8">A name for the parameter, which conforms to the <samp>token</samp> grammar <a href="#RFC7230" class="xref">[RFC7230]</a>
</dd>
<dt>Purpose (optional):</dt>
<dd style="margin-left: 8">A brief identifying the purpose of the parameter.</dd>
<dt>Specification:</dt>
<dd style="margin-left: 8">A link to the specification that defines the format and semantics of the parameter.</dd>
</dl>
<p id="rfc.section.6.1.p.4">This registry initially contains the following entries:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Parameter Name</th>
<th class="left">Purpose</th>
<th class="left">Specification</th>
</tr></thead>
<tbody>
<tr>
<td class="left">t</td>
<td class="left">JWT authentication token</td>
<td class="left">[[RFC-to-be]], <a href="#token" class="xref">Section 3.1</a>
</td>
</tr>
<tr>
<td class="left">k</td>
<td class="left">ECDSA signing key</td>
<td class="left">[[RFC-to-be]], <a href="#key" class="xref">Section 3.2</a>
</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#ack" id="ack">Acknowledgements</a>
</h1>
<p id="rfc.section.7.p.1">This document would have been much worse than it currently is if not for the contributions of Benjamin Bangert, JR Conlin, Chris Karlof, Costin Manolache, Adam Roach, and others.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h2 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h2>
<table><tbody>
<tr>
<td class="reference"><b id="FIPS186">[FIPS186]</b></td>
<td class="top">
<a>National Institute of Standards and Technology (NIST)</a>, "<a>Digital Signature Standard (DSS)</a>", NIST PUB 186-4 , July 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2818">[RFC2818]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, DOI 10.17487/RFC2818, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5226">[RFC5226]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, DOI 10.17487/RFC5226, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6068">[RFC6068]</b></td>
<td class="top">
<a>Duerst, M.</a>, <a>Masinter, L.</a> and <a>J. Zawinski</a>, "<a href="http://tools.ietf.org/html/rfc6068">The 'mailto' URI Scheme</a>", RFC 6068, DOI 10.17487/RFC6068, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6454">[RFC6454]</b></td>
<td class="top">
<a>Barth, A.</a>, "<a href="http://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>", RFC 6454, DOI 10.17487/RFC6454, December 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7159">[RFC7159]</b></td>
<td class="top">
<a>Bray, T.</a>, "<a href="http://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>", RFC 7159, DOI 10.17487/RFC7159, March 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7230">[RFC7230]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7235">[RFC7235]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7235">Hypertext Transfer Protocol (HTTP/1.1): Authentication</a>", RFC 7235, DOI 10.17487/RFC7235, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7518">[RFC7518]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/rfc7518">JSON Web Algorithms (JWA)</a>", RFC 7518, DOI 10.17487/RFC7518, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7519">[RFC7519]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a>", RFC 7519, DOI 10.17487/RFC7519, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8030">[RFC8030]</b></td>
<td class="top">
<a>Thomson, M.</a>, <a>Damaggio, E.</a> and <a>B. Raymor</a>, "<a href="http://tools.ietf.org/html/rfc8030">Generic Event Delivery Using HTTP Push</a>", RFC 8030, DOI 10.17487/RFC8030, December 2016.</td>
</tr>
<tr>
<td class="reference"><b id="X9.62">[X9.62]</b></td>
<td class="top">
<a>ANSI</a>, "<a>Public Key Cryptography For The Financial Services Industry: The Elliptic Curve Digital Signature Algorithm (ECDSA)</a>", ANSI X9.62 , 1998.</td>
</tr>
</tbody></table>
<h2 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h2>
<table><tbody>
<tr>
<td class="reference"><b id="API">[API]</b></td>
<td class="top">
<a>Beverloo, P.</a>, <a>Thomson, M.</a>, <a>van Ouwerkerk, M.</a>, <a>Sullivan, B.</a> and <a>E. Fullea</a>, "<a href="https://w3c.github.io/push-api/">Push API</a>", May 2017.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-webpush-encryption">[I-D.ietf-webpush-encryption]</b></td>
<td class="top">
<a>Thomson, M.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-webpush-encryption-08">Message Encryption for Web Push</a>", Internet-Draft draft-ietf-webpush-encryption-08, February 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3339">[RFC3339]</b></td>
<td class="top">
<a>Klyne, G.</a> and <a>C. Newman</a>, "<a href="http://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>", RFC 3339, DOI 10.17487/RFC3339, July 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7517">[RFC7517]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Peter Beverloo</span> 
	  <span class="n hidden">
		<span class="family-name">Beverloo</span>
	  </span>
	</span>
	<span class="org vcardline">Google</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:beverloo@google.com">beverloo@google.com</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/webpush-wg/webpush-vapid">Fork me on GitHub</a></div></div>
</body>
</html>
